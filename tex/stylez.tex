% All the packages
%\usepackage[letterpaper]{geometry}
\usepackage{microtype}
\usepackage{url}
\usepackage{amsmath}
\usepackage{mathtools}
\usepackage{esint}
\usepackage{amssymb}
\usepackage{natbib}
\usepackage{multirow}
\usepackage{graphicx}
\usepackage{scalerel}
\usepackage{calc}
\usepackage{etoolbox}
\usepackage{marginnote}
\usepackage{nicefrac}
\usepackage{tabstackengine}
\usepackage{diagbox}
\usepackage[makeroom]{cancel}
\usepackage{mathdots}
\usepackage{bbm}
\usepackage{booktabs}
\usepackage{xspace}
\usepackage{upgreek}
\usepackage[T1]{fontenc} % https://tex.stackexchange.com/a/166791
\usepackage{textcomp}
\usepackage{ifxetex}
\ifxetex
\usepackage{fontspec}
\defaultfontfeatures{Extension = .otf}
\fi
\usepackage{fontawesome}
\usepackage{listings}
\usepackage{mathtools}
\stackMath

% Page breaks in long equations
%\allowdisplaybreaks

% Bibliography stuff
\bibliographystyle{aasjournal}

% Shorthand for this paper
\newcommand{\starry}{\textsf{starry}\xspace}
\newcommand{\exocartographer}{\textsf{exocartographer}\xspace}
\newcommand{\earl}{\textsf{EARL}\xspace}
\newcommand{\pybind}{\textsf{pybind11}\xspace}
\newcommand{\batman}{\textsf{batman}\xspace}
\newcommand{\spiderman}{\textsf{spiderman}\xspace}
\newcommand{\planetplanet}{\textsf{planetplanet}\xspace}
\newcommand{\Python}{\textsf{Python}\xspace}
\newcommand{\cpp}{\textsf{C}++\xspace}
\newcommand{\Jupyter}{\textsf{Jupyter}\xspace}
\newcommand{\docs}{\href{https://rodluger.github.io/starry/api.html\#starry.kepler.Planet}{documentation}}
\newcommand{\cn}{{\color{red}citation needed}}
\newcommand{\xxx}[1]{{\color{red}#1}}

% STARRY classes/functions/etc w/ links to docs
\newcommand{\Map}{\href{https://rodluger.github.io/starry/api.html\#starry.Map}{\color{black}\textsf{Map}}\xspace}
\newcommand{\Secondary}{\href{https://rodluger.github.io/starry/api.html\#starry.kepler.Secondary}{\color{black}\textsf{kepler.Secondary}}\xspace}
\newcommand{\Primary}{\href{https://rodluger.github.io/starry/api.html\#starry.kepler.Primary}{\color{black}\textsf{kepler.Primary}}\xspace}
\newcommand{\System}{\href{https://rodluger.github.io/starry/api.html\#starry.kepler.System}{\color{black}\textsf{kepler.System}}\xspace}
\newcommand{\Mapy}{\href{https://rodluger.github.io/starry/api.html\#starry.Map.y}{\color{black}\textsf{Map.y}}\xspace}
\newcommand{\Mapp}{\href{https://rodluger.github.io/starry/api.html\#starry.Map.p}{\color{black}\textsf{Map.p}}\xspace}
\newcommand{\Mapg}{\href{https://rodluger.github.io/starry/api.html\#starry.Map.g}{\color{black}\textsf{Map.g}}\xspace}
\newcommand{\Mapu}{\href{https://rodluger.github.io/starry/api.html\#starry.Map.u}{\color{black}\textsf{Map.u}}\xspace}
\newcommand{\Mapaxis}{\href{https://rodluger.github.io/starry/api.html\#starry.Map.axis}{\color{black}\textsf{Map.axis}}\xspace}
\newcommand{\Mapflux}{\href{https://rodluger.github.io/starry/api.html\#starry.Map.flux}{\color{black}\textsf{Map.flux()}}\xspace}
\newcommand{\SecondaryL}{\href{https://rodluger.github.io/starry/api.html\#starry.kepler.Secondary.L}{\color{black}\textsf{kepler.Secondary.L}}\xspace}
\newcommand{\Systemlightcurve}{\href{https://rodluger.github.io/starry/api.html\#starry.kepler.System.lightcurve}{\color{black}\textsf{kepler.System.lightcurve}}\xspace}
\newcommand{\Systemcompute}{\href{https://rodluger.github.io/starry/api.html\#starry.kepler.System.compute}{\color{black}\textsf{kepler.System.compute()}}\xspace}

% References to text content
\newcommand{\documentname}{\textsl{article}}
\newcommand{\figureref}[1]{\ref{fig:#1}}
\newcommand{\Figure}[1]{Figure~\figureref{#1}}
\newcommand{\figurelabel}[1]{\label{fig:#1}}
\renewcommand{\eqref}[1]{\ref{eq:#1}}
\newcommand{\Eq}[1]{Equation~(\eqref{#1})}
\newcommand{\eq}[1]{\Eq{#1}}
\newcommand{\eqalt}[1]{Equation~\eqref{#1}}

% Add code, proof, and animation hyperlinks
\definecolor{linkcolor}{rgb}{0.1216,0.4667,0.7059}
\newcommand{\codeicon}{{\color{linkcolor}\faFileCodeO}}
\newcommand{\prooficon}{{\color{linkcolor}\faPencilSquareO}}
\newcommand{\animicon}{{\color{linkcolor}\faPlayCircle}}
\input{gitlinks}


\newtagform{eqtag}[]{(}{)}
\newcommand{\currentlabel}{None}

% Define a proof environment
\newenvironment{proof}[1]{%
\ifstrempty{#1}{%
\renewtagform{eqtag}[]{\raisebox{-0.1em}{{\color{red}\faPencilSquareO}}\,(}{)}%
}{%
\renewtagform{eqtag}[]{\prooflink{#1}\,(}{)}%
}%
\usetagform{eqtag}%
\renewcommand{\currentlabel}{#1}
\align%
}{%
\endalign%
\renewtagform{eqtag}[]{(}{)}%
\usetagform{eqtag}%
\message{<<<\currentlabel: \theequation>>>}%
}

% Define a proof environment
\newenvironment{proof*}[1]{%
\ifstrempty{#1}{%
\renewtagform{eqtag}[]{\raisebox{-0.1em}{{\color{red}\faPencilSquareO}}\,(}{)}%
}{%
\renewtagform{eqtag}[]{\prooflink{#1}\,(}{)}%
}%
\usetagform{eqtag}%
\renewcommand{\currentlabel}{#1}
\equation%
}{%
\endequation%
\renewtagform{eqtag}[]{(}{)}%
\usetagform{eqtag}%
\message{<<<\currentlabel: \theequation>>>}
}

% Math stuff
\newcommand{\ii}{\ensuremath{\mathbf{i}}}
\newcommand{\dd}{\ensuremath{ \mathrm{d}}}
\newcommand{\unit}[1]{{\ensuremath{\mathrm{#1}}}}
\newcommand{\bvec}[1]{{\ensuremath{\mathbf{#1}}}}
\newcommand{\avec}[1]{{\ensuremath{\vec{\mathbf{#1}}}}}
\newcommand{\x}{\ensuremath{\mbox{$x$}}}
\newcommand{\y}{\ensuremath{\mbox{$y$}}}
\newcommand{\z}{\ensuremath{\mbox{$z$}}}
\newcommand{\xhat}{\ensuremath{\mathbf{\hat{x}}}\xspace}
\newcommand{\yhat}{\ensuremath{\mathbf{\hat{y}}}\xspace}
\newcommand{\zhat}{\ensuremath{\mathbf{\hat{z}}}\xspace}
\DeclareMathAlphabet\mathbfcal{OMS}{cmsy}{b}{n}
\DeclareMathOperator{\Tr}{Tr}
\DeclarePairedDelimiter\ceil{\lceil}{\rceil}
\DeclarePairedDelimiter\floor{\lfloor}{\rfloor}
\definecolor{dim}{rgb}{0.8,0.8,0.8}
\newcolumntype{L}[1]{>{\raggedright\let\newline\\\arraybackslash\hspace{0pt}}m{#1}}
\setcounter{MaxMatrixCols}{20}
\newcommand{\sinphi}{\ensuremath{\mbox{$u$}}}
\newcommand{\sinlambda}{\ensuremath{\mbox{$v$}}}
\newcommand{\bigdot}{\scaleto{\cdot}{6pt}}

% Bases
\newcommand{\pbasis}{\ensuremath{\tilde{\bvec{p}}}}
\newcommand{\gbasis}{\ensuremath{\tilde{\bvec{g}}}}
\newcommand{\ybasis}{\ensuremath{\tilde{\bvec{y}}}}
\newcommand{\pbasisn}{\ensuremath{\tilde{p}_n}}
\newcommand{\gbasisn}{\ensuremath{\tilde{g}_n}}
\newcommand{\ybasisn}{\ensuremath{\tilde{y}_n}}
\newcommand{\AOne}{\ensuremath{\bvec{A_1}}}
\newcommand{\ATwo}{\ensuremath{\bvec{A_2}}}

% Code examples
\definecolor{codegreen}{rgb}{0,0.6,0}
\definecolor{codegray}{rgb}{0.5,0.5,0.5}
\definecolor{codepurple}{rgb}{0.58,0,0.82}
\definecolor{backcolour}{rgb}{0.95,0.95,0.95}
\lstdefinestyle{mystyle}{
    backgroundcolor=\color{backcolour},
    commentstyle=\color{codegreen},
    keywordstyle=\color{magenta},
    numberstyle=\tiny\color{codegray},
    stringstyle=\color{codepurple},
    basicstyle=\small\ttfamily,
    breakatwhitespace=false,
    breaklines=true,
    captionpos=b,
    keepspaces=true,
    numbers=left,
    numbersep=5pt,
    showspaces=false,
    showstringspaces=false,
    showtabs=false,
    tabsize=2,
    aboveskip=1em,
    belowskip=1em,
    keywords=[2]{map},
    keywordstyle=[2]{\color{black!80!black}},
    upquote=true
}
\lstset{style=mystyle}

% Inverse diagonal dots
\makeatletter
\def\Ddots{\mathinner{\mkern1mu\raise\p@
\vbox{\kern7\p@\hbox{.}}\mkern2mu
\raise4\p@\hbox{.}\mkern2mu\raise7\p@\hbox{.}\mkern1mu}}
\makeatother

% Typography obsessions
\setlength{\parindent}{3.0ex}
\renewcommand\quad{\hskip\fontdimen3\font}
